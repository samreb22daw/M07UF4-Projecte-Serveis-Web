<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consultar Servidor</title>
    <script type="text/javascript">

        // ESTADO SERVIDOR
        var xhr = new XMLHttpRequest();
        xhr.withCredentials = true;

        xhr.addEventListener("readystatechange", function () {
            if (this.readyState === 4) {
                console.log(this.responseText);
                document.getElementById("sConsultarServidor").innerHTML = this.responseText;
            }
        });

        xhr.open("GET", "http://localhost:3000/consultarServidor");

        xhr.send(null);
        //----------------------------------------------------------

        function crearPartida() {
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;

            xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    console.log(this.responseText);
                    document.getElementById("sCrearPartida").innerHTML = this.responseText;

                }
            });

            xhr.open("POST", "http://localhost:3000/iniciarPartida/codiPartida/" + gameCode.value);

            xhr.send();
        }

        function consultarPartida() {
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;

            xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    console.log(this.responseText);
                    let jsonRes = JSON.parse(this.responseText)

                    document.getElementById("title").innerHTML = "Estat de la partida amb codi: " + jsonRes.gameCode;
                    document.getElementById("sGuanyades1").innerHTML = jsonRes.tornsGuanyatsJugador1;
                    document.getElementById("sGuanyades2").innerHTML = jsonRes.tornsGuanyatsJugador2;
                }
            });

            xhr.open("GET", "http://localhost:3000/consultarEstatPartida/" + gameCode.value);

            xhr.send();
        }

        function acabarPartida() {
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;

            xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    console.log(this.responseText);
                    document.getElementById("sEsborraPartida").innerHTML = this.responseText;
                }
            });

            xhr.open("DELETE", "http://localhost:3000/acabarPartida/" + esborraPartida.value);

            xhr.send()
        }

        function escollirJugada() {
            var xhr = new XMLHttpRequest();
            xhr.withCredentials = true;

            xhr.addEventListener("readystatechange", function () {
                if (this.readyState === 4) {
                    console.log(this.responseText);
                    document.getElementById("sEscollirJugada").innerHTML = this.responseText;
                }
            });

            xhr.open("PUT", "http://localhost:3000/moureJugador/" + escollirCodiPartida.value + "/" + escollirJugador.value + "/" + jugadaEscollida.value );

            xhr.send()
        }

    </script>
</head>

<br>
    ESTAT DEL SERVIDOR<br>
    <label id="sConsultarServidor"></label><br><br>

    CREA I CONSULTA LES PARTIDES:<br>
    Indica el codi de partida que vols crear:
    <input type="number" name="gameCode" id="gameCode" value="0" /><br>
    
    <button onclick="crearPartida()">Crear partida</button><button onclick="consultarPartida()">Consultar partida</button><br><br>

    <label id="sCrearPartida"></label><br>

    
    <br>
    <table id="taulaPartida" style="text-align: center;" border="solid 1px">
        <tr>
            <th colspan="2" id="title">Estat de la partida amb codi: </th>
        </tr>
        <tr>
            <td style="padding-right: 10px;">Partides guanyades per el jugador 1</td>
            <td>Partides guanyades per el jugador 2</td>
        </tr>
        <tr>
            <td id="sGuanyades1"> </td>
            <td id="sGuanyades2"> </td>
        </tr>
    </table>

    <br><br>

    TERMINAR PARTIDA:</br>
    Indica el codi de la partida que vols esborrar:
    <input type="number" name="esborraPartida" id="esborraPartida" value="0" /><br/>
    
    <button onclick="acabarPartida()">Esborrar partida</button><br>
    <label id="sEsborraPartida"></label><br>

    ESCOLLIR JUGADA:</br>
    Introdueix el codi de partida:
    <input type="number" name="escollirCodiPartida" id="escollirCodiPartida"><br>
    Introdueix quin jugador ets:
    <input type="number" id="escollirJugador" name="escollirJugador"><br>
    Introdueix la jugada:
    <select id="jugadaEscollida" name="jugadaEscollida">
        <option value="pedra">Pedra</option>
        <option value="paper">Paper</option>
        <option value="tissora">Tissora</option>
      </select>
    <button onclick="escollirJugada()">Escollir jugada!</button>
    <br><label id="sEscollirJugada"></label><br>

    JUGAR PARTIDA:
    <input type="number" name="jugarCodiPartida" id="jugarCodiPartida"><br>
    <button id="jugarPartida"></button>






</body>

</html>